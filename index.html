<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cotizador de Servicios</title>
</head>
<body>

    <!-- Contenedor de servicios -->
    <div id="contenedor-servicios">
        <!-- Ejemplo de servicios -->
        <div class="servicio" data-precio="400" data-promocion="true">
            <h3>Fotografía de Producto Conceptual (mínimo 5)</h3>
            <p>$400.00/foto</p>
            <select class="cantidad" id="foto_producto_conceptual_min5">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
            </select>
        </div>
        
        <div class="servicio" data-precio="1500" data-promocion="false">
            <h3>Servicio de Diseño Gráfico Premium</h3>
            <p>$1500.00/servicio</p>
            <select class="cantidad" id="servicio_diseno_grafico_premium">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
            </select>
        </div>
        

    </div>
    
    <div id="resumen-compra" style="display:none;"></div>

    <div id="botones">
        <button id="continuar">Continuar</button>
        <button id="reiniciar">Reiniciar</button>
    </div>
    
    <div id="botones-resumen" style="display:none;">
        <!-- El botón "Atrás" se agregará dinámicamente aquí -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const botonContinuar = document.getElementById('continuar');
            const botonReiniciar = document.getElementById('reiniciar');
            const contenedorServicios = document.getElementById('contenedor-servicios');
            const resumenCompra = document.getElementById('resumen-compra');
            const botonesResumen = document.getElementById('botones-resumen');
            const servicios = document.querySelectorAll('.servicio');

            function guardarSelecciones() {
                servicios.forEach(servicio => {
                    const select = servicio.querySelector('.cantidad');
                    localStorage.setItem(select.id, select.value);
                });
            }

            function cargarSelecciones() {
                servicios.forEach(servicio => {
                    const select = servicio.querySelector('.cantidad');
                    const valorGuardado = localStorage.getItem(select.id);
                    if (valorGuardado) {
                        select.value = valorGuardado;
                    }
                    select.addEventListener('change', () => guardarSelecciones());
                });
            }

            function calcularResumen() {
                let total = 0;
                let resumenHtml = "<h2>Resumen de Compra</h2>";

                servicios.forEach(servicio => {
                    const cantidad = parseInt(localStorage.getItem(servicio.querySelector('.cantidad').id) || '0');
                    const precio = parseInt(servicio.dataset.precio);
                    const nombre = servicio.querySelector('h3').textContent;
                    const tienePromocion = servicio.dataset.promocion === "true";

                    if (cantidad > 0) {
                        let subtotal = 0;
                        if (tienePromocion && cantidad > 10) {
                            const cantidadConDescuento = cantidad - 10;
                            const precioConDescuento = precio * 0.7;
                            subtotal = (10 * precio) + (cantidadConDescuento * precioConDescuento);
                            resumenHtml += `<p>${nombre} (${precio} por unidad) x 10 = $${10 * precio}</p>`;
                            resumenHtml += `<p>${nombre} (${precioConDescuento.toFixed(2)} por unidad con descuento) x ${cantidadConDescuento} = $${(cantidadConDescuento * precioConDescuento).toFixed(2)}</p>`;
                        } else {
                            subtotal = cantidad * precio;
                            resumenHtml += `<p>${nombre} (${precio} por unidad) x ${cantidad} = $${subtotal}</p>`;
                        }
                        total += subtotal;
                    }
                });

                resumenHtml += `<h3>Total: $${total.toFixed(2)}</h3>`;
                resumenCompra.innerHTML = resumenHtml;
                contenedorServicios.style.display = 'none';
                botonContinuar.style.display = 'none';
                resumenCompra.style.display = 'block';

                // Limpiar botonesResumen y agregar botón volver
                botonesResumen.innerHTML = '';
                const volverBtn = document.createElement('button');
                volverBtn.id = 'volver';
                volverBtn.textContent = 'Atrás';
                botonesResumen.appendChild(volverBtn);

                // Añadir el botón Reiniciar al botonesResumen
                botonesResumen.appendChild(botonReiniciar);
                botonesResumen.style.display = 'block';

                volverBtn.addEventListener('click', () => {
                    localStorage.removeItem('estadoPagina');
                    location.reload();
                });
            }

            botonContinuar.addEventListener('click', () => {
                guardarSelecciones();
                localStorage.setItem('estadoPagina', 'resumen');
                calcularResumen();
            });

            botonReiniciar.addEventListener('click', () => {
                const confirmado = confirm("Esto reiniciará el cotizador, borrando todas las selecciones actuales. ¿Deseas continuar?");
                if (confirmado) {
                    localStorage.clear();
                    location.reload();
                }
            });

            const estadoPagina = localStorage.getItem('estadoPagina');
            if (estadoPagina === 'resumen') {
                calcularResumen();
            } else {
                cargarSelecciones();
            }
        });


    </script>

</body>
</html>
