<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cotizador de Servicios</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 50px 5vw; /* Márgenes dinámicos */
            padding-bottom: 25px;
        }

        .contenedor-servicios {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start; /* Alineación a la izquierda */
        }
    
        .servicio {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            margin: 10px;
            padding: 25px;
            width: calc(25% - 20px); /* Tres tarjetas por fila en pantallas grandes */
            box-sizing: border-box;
            border-radius: 10px;
            background-color: #f0f0f0;
        }
    
        .servicio.selected {
            background-color: #e2f8cd;
        }
    
        .servicio .controles {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
    
        .servicio .controles select,
        .servicio .controles .input-cantidad {
            font-size: 16px;
            border-radius: 5px;
            padding: 8px;
        }
    
        .servicio .controles select {
            width: 100%; /* Cambiado de 70% a 100% */
        }
    
        .servicio .controles .input-cantidad {
            width: 30%;
            display: none;
            margin-left: 10px;
        }
    
        .servicio h3 {
            margin: 0;
            margin-bottom: 0.5em;
            font-size: 18px;
        }
    
        .servicio p {
            font-size: 16px;
        }
    
        #botones, #botones-resumen {
            margin: 20px 0;
            text-align: center;
        }
    
        button {
            margin: 10px;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 18px;
            border: none;
            transition: background-color 0.2s;
        }
    
        #continuar {
            background-color: #73c034;
            color: white;
        }
    
        #continuar:hover {
            background-color: #45a049;
        }
    
        #reiniciar {
            background-color: #ec6259;
            color: white;
        }
    
        #reiniciar:hover {
            background-color: #d32f2f;
        }
    
        #volver {
            background-color: #ffcc80;
        }
    
        #resumen-compra {
            font-size: 18px;
        }
    
        .resumen-servicio {
            background-color: #fff6dc;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        @media (max-width: 1450px) {
            .servicio {
                width: calc(33.33% - 20px); /* Tres tarjetas por fila */
            }
        }

        @media (max-width: 1200px) {
            .servicio {
                width: calc(50% - 20px); /* Dos tarjetas por fila en pantallas medianas */
            }
        }
    
        @media (max-width: 1024px) {
            body {
                padding: 50px 2vw; /* Menos margen para pantallas pequeñas */
            }
    
            .servicio {
                width: 100%; /* Una tarjeta por fila en pantallas pequeñas */
            }
    
            #resumen-compra {
                font-size: 16px; /* Tamaño de fuente ajustado para el resumen en pantallas pequeñas */
            }
    
            .servicio h3, .servicio p, button {
                font-size: 16px; /* Tamaño de fuente ajustado para elementos en pantallas pequeñas */
            }
    
            button {
                padding: 12px 20px;
            }
        }
    </style>
    

</head>
<body>

    <div class="categoria">
        <h1 class="titulo-categoria">Diseño</h1>
        <!-- Contenedor de servicios -->
        <div class="contenedor-servicios">
            <!-- Ejemplo de servicios -->
            <div class="servicio" data-precio="400" data-promocion="true">
                <h3>Fotografía de Producto Conceptual (mínimo 5)</h3>
                <p>$400.00/foto</p>
                <div class="controles">
                    <select class="cantidad">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">Otra cantidad</option>
                    </select>
                    <input type="number" class="input-cantidad" style="display: none;" min="0" max="99">
                </div>
            </div>
            <!-- Ejemplo de servicios -->
        </div>
        <!-- Contenedor de servicios -->
    </div>



    <div class="categoria">
        <h1 class="titulo-categoria">Multimedia</h1>
        <!-- Contenedor de servicios -->
        <div class="contenedor-servicios">
            <!-- Ejemplo de servicios -->
            <div class="servicio" data-precio="400" data-promocion="true">
                <h3>Esos</h3>
                <p>$500.00/foto</p>
                <div class="controles">
                    <select class="cantidad">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">Otra cantidad</option>
                    </select>
                    <input type="number" class="input-cantidad" style="display: none;" min="0" max="99">
                </div>
            </div>
            <!-- Ejemplo de servicios -->
        </div>
        <!-- Contenedor de servicios -->
    </div>
    
    <div id="resumen-compra" style="display:none;"></div>

    <div id="botones">
        <button id="continuar">Continuar</button>
        <button id="reiniciar">Reiniciar</button>
    </div>
    
    <div id="botones-resumen" style="display:none;">
        
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const botonContinuar = document.getElementById('continuar');
            const botonReiniciar = document.getElementById('reiniciar');
            const contenedoresServicios = document.querySelectorAll('.contenedor-servicios');
            const resumenCompra = document.getElementById('resumen-compra');
            const botonesResumen = document.getElementById('botones-resumen');

            let servicioGlobalIndex = 0;  // Índice global para todos los servicios

            document.querySelectorAll('.servicio').forEach((servicio, index) => {
                servicio.setAttribute('data-index', servicioGlobalIndex++);
                const select = servicio.querySelector('.cantidad');
                const valorGuardado = localStorage.getItem('servicio_' + servicio.getAttribute('data-index'));

                if (valorGuardado && valorGuardado !== '0') {
                    servicio.classList.add('selected');
                }

                select.addEventListener('change', function() {
                    if (this.value !== '0') {
                        servicio.classList.add('selected');
                    } else {
                        servicio.classList.remove('selected');
                    }
                    localStorage.setItem('servicio_' + servicio.getAttribute('data-index'), this.value);
                });
            });

            contenedoresServicios.forEach((contenedor, contenedorIndex) => {
                const servicios = contenedor.querySelectorAll('.servicio');

                servicios.forEach(servicio => {
                    const servicioId = 'servicio_' + servicio.getAttribute('data-index');
                    const select = servicio.querySelector('.cantidad');
                    let input = servicio.querySelector('.input-cantidad');

                    if (!input) {
                        input = document.createElement('input');
                        input.type = 'number';
                        input.classList.add('input-cantidad');
                        input.style.width = '50px';
                        input.style.display = 'none';
                        input.min = 0;
                        input.max = 99;
                        servicio.appendChild(input);
                    }

                    select.addEventListener('change', function() {
                        if (this.value === '21') {
                            input.style.display = 'inline-block';
                            input.focus();
                            select.style.width = '100%';
                        } else {
                            input.style.display = 'none';
                            select.style.width = '100%';
                        }
                        localStorage.setItem(servicioId, this.value);
                    });

                    input.addEventListener('blur', () => {
                        const num = parseInt(input.value);
                        if (!isNaN(num) && num >= 0 && num <= 99) {
                            const optionExists = [...select.options].some(option => option.value === num.toString());
                            if (optionExists) {
                                select.value = num.toString();
                                input.style.display = 'none';
                                select.style.width = '100%';
                                localStorage.setItem(servicioId, num.toString());
                            } else {
                                localStorage.setItem(servicioId + '_custom', input.value);
                            }
                        } else if (input.value.trim() === '') {
                            select.value = '0';
                            input.style.display = 'none';
                            select.style.width = '100%';
                            localStorage.setItem(servicioId, '0');
                            servicio.classList.remove('selected');
                        }
                    });

                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            input.blur();
                        }
                    });

                    const valorGuardado = localStorage.getItem(servicioId);
                    if (valorGuardado) {
                        select.value = valorGuardado;
                        if (valorGuardado === '21') {
                            input.style.display = 'inline-block';
                            const valorGuardadoCustom = localStorage.getItem(servicioId + '_custom');
                            input.value = valorGuardadoCustom || '';
                        } else {
                            input.style.display = 'none';
                        }
                        select.style.width = '100%'; // Asegurar que select esté al 100% al cargar
                        if (valorGuardado !== '0' && valorGuardado !== '21') {
                            servicio.classList.add('selected');
                        } else {
                            servicio.classList.remove('selected');
                        }
                    }
                });
            });



            function guardarSelecciones() {
                document.querySelectorAll('.servicio').forEach(servicio => {
                    const servicioId = 'servicio_' + servicio.getAttribute('data-index');
                    const select = servicio.querySelector('.cantidad');
                    const input = servicio.querySelector('.input-cantidad');
                    localStorage.setItem(servicioId, select.value);
                    if (select.value === '21' && input.value) {
                        localStorage.setItem(servicioId + '_custom', input.value);
                    }
                });
            }

            botonContinuar.addEventListener('click', () => {
                guardarSelecciones();
                localStorage.setItem('estadoPagina', 'resumen');
                calcularResumen();
            });

            botonReiniciar.addEventListener('click', () => {
                if (confirm("Esto reiniciará el cotizador, borrando todas las selecciones actuales. ¿Deseas continuar?")) {
                    localStorage.clear();
                    location.reload();
                }
            });

            const estadoPagina = localStorage.getItem('estadoPagina');
            if (estadoPagina === 'resumen') {
                mostrarResumen();
            } else {
                cargarSelecciones();
            }

            function calcularResumen() {
                let total = 0;
                let resumenHtml = "<h2>Resumen de Compra</h2>";
                contenedoresServicios.forEach(contenedor => contenedor.style.display = 'none');

                const tituloc = document.querySelectorAll('.titulo-categoria'); // Selecciona todos los contenedores de categorías
                tituloc.forEach(titulo => titulo.style.display = 'none'); // Oculta cada contenedor de categoría

                const formatter = new Intl.NumberFormat('en-US', {
                    style: 'decimal',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2,
                });

                document.querySelectorAll('.servicio').forEach(servicio => {
                    const servicioId = 'servicio_' + servicio.getAttribute('data-index');
                    const select = servicio.querySelector('.cantidad');
                    const input = servicio.querySelector('.input-cantidad');
                    let cantidad = select.value === '21' ? parseInt(localStorage.getItem(servicioId + '_custom') || 0) : parseInt(select.value);
                    const precio = parseInt(servicio.dataset.precio);
                    const nombre = servicio.querySelector('h3').textContent;
                    const tienePromocion = servicio.dataset.promocion === "true";

                    let subtotal = 0;
                    if (cantidad > 0) {
                        if (tienePromocion && cantidad > 10) {
                            const cantidadSinDescuento = 10;
                            const cantidadConDescuento = cantidad - 10;
                            const precioConDescuento = precio * 0.7;
                            subtotal = (cantidadSinDescuento * precio) + (cantidadConDescuento * precioConDescuento);
                            resumenHtml += `<div class="resumen-servicio"><p>${nombre} (${formatter.format(precio)} por unidad) x ${cantidadSinDescuento} = ${formatter.format(cantidadSinDescuento * precio)}</p>`;
                            resumenHtml += `<p>${nombre} (${formatter.format(precioConDescuento)} por unidad con descuento) x ${cantidadConDescuento} = ${formatter.format(cantidadConDescuento * precioConDescuento)}</p></div>`;
                        } else {
                            subtotal = cantidad * precio;
                            resumenHtml += `<div class="resumen-servicio"><p>${nombre} (${formatter.format(precio)} por unidad) x ${cantidad} = ${formatter.format(subtotal)}</p></div>`;
                        }
                        total += subtotal;
                    }
                });

                const iva = total * 0.16;
                const totalConIVA = total + iva;

                resumenHtml += `<h3>Total: ${formatter.format(total)}</h3>`;
                resumenHtml += `<p>IVA (16%): ${formatter.format(iva)}</p>`;
                resumenHtml += `<h3>Total con IVA: ${formatter.format(totalConIVA)}</h3>`;

                localStorage.setItem('resumenHtml', resumenHtml);

                resumenCompra.innerHTML = resumenHtml;
                botonContinuar.style.display = 'none';
                resumenCompra.style.display = 'block';

                botonesResumen.innerHTML = '<button id="volver">Atrás</button>';
                const volverBtn = document.getElementById('volver');
                volverBtn.addEventListener('click', () => {
                    localStorage.removeItem('estadoPagina');
                    location.reload();
                });

                botonesResumen.appendChild(botonReiniciar);
                botonesResumen.style.display = 'block';
            }

            function mostrarResumen() {
                const resumenHtml = localStorage.getItem('resumenHtml');
                
                const categorias = document.querySelectorAll('.categoria'); // Selecciona todos los contenedores de categorías
                categorias.forEach(categoria => categoria.style.display = 'none'); // Oculta cada contenedor de categoría

                contenedoresServicios.forEach(contenedor => contenedor.style.display = 'none');
                resumenCompra.innerHTML = resumenHtml || "<p>No hay datos de resumen disponibles.</p>";
                botonContinuar.style.display = 'none';
                resumenCompra.style.display = 'block';

                botonesResumen.innerHTML = '<button id="volver">Atrás</button>';
                const volverBtn = document.getElementById('volver');
                volverBtn.addEventListener('click', () => {
                    localStorage.removeItem('estadoPagina');
                    location.reload();
                });

                botonesResumen.appendChild(botonReiniciar);
                botonesResumen.style.display = 'block';
            }

            function cargarSelecciones() {
                const tituloc = document.querySelectorAll('.titulo-categoria'); // Selecciona todos los contenedores de categorías
                tituloc.forEach(titulo => titulo.style.display = 'block'); // Oculta cada contenedor de categoría

                document.querySelectorAll('.servicio').forEach(servicio => {
                    const servicioId = 'servicio_' + servicio.getAttribute('data-index');
                    const select = servicio.querySelector('.cantidad');
                    const input = servicio.querySelector('.input-cantidad');
                    const valorGuardado = localStorage.getItem(servicioId);
                    const valorPersonalizado = localStorage.getItem(servicioId + '_custom');

                    if (valorGuardado) {
                        select.value = valorGuardado;
                        if (valorGuardado === '21') {
                            input.style.display = 'inline-block';
                            input.value = valorPersonalizado || '';
                        } else {
                            input.style.display = 'none';
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>

